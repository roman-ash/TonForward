# –†–µ–∑—é–º–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å TON Blockchain

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ú–æ–¥—É–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å TON

#### `core/ton_client.py`
HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è TonCenter API v2:
- ‚úÖ `send_boc()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ BOC —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ `get_address_information()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–¥—Ä–µ—Å–µ
- ‚úÖ `run_get_method()` - –≤—ã–∑–æ–≤ GET –º–µ—Ç–æ–¥–æ–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
- ‚úÖ `get_wallet_seqno()` - –ø–æ–ª—É—á–µ–Ω–∏–µ seqno –∫–æ—à–µ–ª—å–∫–∞

#### `core/ton_wallet.py`
–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å TON –∫–æ—à–µ–ª—å–∫–æ–º:
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ mnemonic —Ñ—Ä–∞–∑—ã
- ‚úÖ `deploy_contract()` - –¥–µ–ø–ª–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —Å escrow
- ‚úÖ `send_transfer()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ TON

#### `core/ton_contracts.py`
–†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ Deal:
- ‚úÖ `load_deal_code_cell()` - –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏–∑ base64
- ‚úÖ `build_deal_init_data_cell()` - —Å–±–æ—Ä–∫–∞ init data –¥–ª—è –¥–µ–ø–ª–æ—è
- ‚úÖ `calculate_contract_address()` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

#### `core/ton_utils.py`
–í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚úÖ `deploy_onchain_deal()` - –¥–µ–ø–ª–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Å fallback –Ω–∞ mock
- ‚úÖ `call_contract_method()` - –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–æ–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
- ‚úÖ `get_contract_state()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
- ‚úÖ `sync_deal_status_from_chain()` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

### 2. Tact –∫–æ–Ω—Ç—Ä–∞–∫—Ç Deal

#### `contracts/Deal_simple.tact`
‚úÖ –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- –†–∞–∑–º–µ—Ä BOC: 1914 bytes
- Base64 –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ `contracts/Deal_Deal.code.b64`
- –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
  - `mark_purchased`, `mark_shipped`, `confirm_delivery`
  - `cancel_before_purchase`, `cancel_before_ship`
  - `auto_complete_for_buyer`
  - `open_dispute`
  - `resolve_dispute_refund_customer`, `resolve_dispute_pay_buyer`, `resolve_dispute_split`
  - `get_status`, `get_data`

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Django

‚úÖ Celery –∑–∞–¥–∞—á–∞ `deploy_onchain_deal` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ webhook
‚úÖ –í—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ views
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ on-chain ‚Üî off-chain

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`):

```bash
# TonCenter API
TONCENTER_API_KEY=your_api_key_here
TONCENTER_URL=https://toncenter.com/api/v2

# TON –∫–æ—à–µ–ª–µ–∫
TON_MNEMONIC="word1 word2 ... word24"

# –ê–¥—Ä–µ—Å–∞
TON_SERVICE_WALLET=EQ...
TON_ARBITER_WALLET=EQ...

# –ö–æ–¥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (–¥–æ–±–∞–≤–ª–µ–Ω)
DEAL_CONTRACT_CODE_B64="te6ccgECGwEAB24AART/..."
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`requirements.txt`):

```bash
httpx>=0.24.0
tonsdk
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ:

```python
>>> from core.ton_contracts import load_deal_code_cell
>>> code_cell = load_deal_code_cell()
>>> print("‚úì Contract loaded!")
‚úì Contract loaded!
```

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (`TON_MNEMONIC`, `TON_SERVICE_WALLET`, `TON_ARBITER_WALLET`) —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫:

1. **–î–µ–ø–ª–æ—é –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
2. **–í—ã–∑–æ–≤—É –º–µ—Ç–æ–¥–æ–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞** - —á–µ—Ä–µ–∑ `call_contract_method()`
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤** - —á–µ—Ä–µ–∑ `sync_deal_status_from_chain()`
4. **–û–±—Ä–∞–±–æ—Ç–∫–µ —Ç–∞–π–º-–∞—É—Ç–æ–≤** - —á–µ—Ä–µ–∑ Celery –∑–∞–¥–∞—á–∏

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (TON_MNEMONIC, –∞–¥—Ä–µ—Å–∞)
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ testnet –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞ mainnet
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ Deal
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (YooKassa, Tinkoff)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `core/README_TON.md` - –æ–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `contracts/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É
- `contracts/SETUP_CONTRACT.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- `CHECK_CONTRACT.md` - —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∑–∞–≥—Ä—É–∑–∫–æ–π

