<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Deal Contract Deploy Test</title>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
        }
        button {
            background: #0088cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0066aa;
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: #333;
        }
        .success { background: #2a5a2a; }
        .error { background: #5a2a2a; }
        .info { background: #2a2a5a; }
        code {
            background: #1a1a1a;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
            word-break: break-all;
        }
        textarea {
            width: 100%;
            height: 100px;
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #555;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ TON Deal Contract Deploy Test</h1>
        
        <div id="tonconnect-status" class="status info">
            TonConnect –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω. –ù–∞–∂–º–∏—Ç–µ "Connect Wallet" –¥–ª—è –Ω–∞—á–∞–ª–∞.
        </div>
        
        <button id="connect-btn">Connect Wallet</button>
        <button id="disconnect-btn" disabled>Disconnect</button>
        
        <h2>Contract Parameters</h2>
        <p>
            <label>Contract Code (base64):</label><br>
            <textarea id="code-b64" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ DEAL_CONTRACT_CODE_B64 –∏–∑ .env"></textarea>
        </p>
        
        <p>
            <label>Contract Address (–±—É–¥–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):</label><br>
            <code id="contract-address">-</code>
        </p>
        
        <button id="calculate-address-btn">Calculate Contract Address</button>
        <button id="deploy-btn" disabled>Deploy Contract</button>
        
        <div id="result" class="status info" style="display:none;"></div>
    </div>

    <script type="module">
        let tonConnectUI;
        let wallet = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TonConnect UI
        tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: window.location.origin + '/tonconnect-manifest.json'
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        tonConnectUI.connectionState.subscribe(state => {
            if (state) {
                wallet = state.account;
                updateStatus('success', `–ü–æ–¥–∫–ª—é—á–µ–Ω: ${wallet.address}`);
                document.getElementById('connect-btn').disabled = true;
                document.getElementById('disconnect-btn').disabled = false;
                document.getElementById('deploy-btn').disabled = false;
            } else {
                wallet = null;
                updateStatus('info', 'TonConnect –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
                document.getElementById('connect-btn').disabled = false;
                document.getElementById('disconnect-btn').disabled = true;
                document.getElementById('deploy-btn').disabled = true;
            }
        });
        
        // –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        document.getElementById('connect-btn').addEventListener('click', () => {
            tonConnectUI.openModal();
        });
        
        // –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
        document.getElementById('disconnect-btn').addEventListener('click', () => {
            tonConnectUI.disconnect();
        });
        
        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
        document.getElementById('calculate-address-btn').addEventListener('click', async () => {
            const codeB64 = document.getElementById('code-b64').value.trim();
            if (!codeB64) {
                updateStatus('error', '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞');
                return;
            }
            
            updateStatus('info', '–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞...');
            
            // –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω—É–∂–Ω—ã code –∏ init_data
            // –ó–¥–µ—Å—å –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä
            updateStatus('info', '–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –Ω—É–∂–Ω—ã code –∏ init_data. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è —ç—Ç–æ–≥–æ.');
        });
        
        // –î–µ–ø–ª–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
        document.getElementById('deploy-btn').addEventListener('click', async () => {
            if (!wallet) {
                updateStatus('error', '–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫');
                return;
            }
            
            const codeB64 = document.getElementById('code-b64').value.trim();
            if (!codeB64) {
                updateStatus('error', '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞');
                return;
            }
            
            updateStatus('info', '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–µ–ø–ª–æ—è...');
            
            try {
                // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
                // –ü–æ–∫–∞ —ç—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä
                updateStatus('error', '–ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ TonConnect —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è.');
            } catch (error) {
                updateStatus('error', `–û—à–∏–±–∫–∞: ${error.message}`);
            }
        });
        
        function updateStatus(type, message) {
            const statusEl = document.getElementById('tonconnect-status');
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
            
            const resultEl = document.getElementById('result');
            resultEl.style.display = 'block';
            resultEl.className = `status ${type}`;
            resultEl.textContent = message;
        }
    </script>
</body>
</html>

